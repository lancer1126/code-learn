# Redis事务

可以一次执行多个命令，本质时一组命令的集合。一个事务的所有命令都会序列化，按顺序的串行化执行而不会被其他命令插入。  

### 特点

* 事务是一个单独的隔离操作：事务中的命令都会被序列化，按顺序地执行。事务在执行过程中，不会被其他客户端发送来的命令请求打断。 
* 事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。

### 命令

* DISCARD：取消事务，放弃执行事务块内的所有命令
* EXEC：执行事务块内的命令
* MULTI：标记一个事务块的开始
* WATCH key：监视一个或多个key，如果在事务执行之前这个key被其他命令所改动，那么事务将会被打断。
* UNWATCH：取消WATCH命令对所有key的监视

### 三阶段

1. 开启：以MULTI开启一个事务
2. 入队：将多个命令入队到事务中，接到这些命令并不会立刻执行，而是放到等待事务执行的队列中去。
3. 执行：有EXEC命令出发事务。

### 小节

* Watch指令类似乐观锁，事务提交时，如果key的值已经被别的客户端改变，比如某个list已被别的客户端push/pop过了，整个事务队列都不会被执行。
* 通过WATCH命令在事务执行之前监控多个keys，倘若在WATCH之后有任何key的值发生了变化，EXEC命令执行的事务都将被抛弃，同时返回Nullmulti-bulk以糖脑苷脂调用者事务失败。